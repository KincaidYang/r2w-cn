<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务 | 归去如风</title><meta name="author" content="小泽"><meta name="copyright" content="小泽"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍如何使用 BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务，一般来讲，对于高可用的场景来说，单一的 DNS 服务商提供的 DNS 服务无法满足灾备的需求，所以我们需要使用多个 DNS 服务商来进行冗余备份，本文将指导您使用 BIND 9 作为主 DNS 服务器（不对外提供服务），CloudNS 和 NS1 (NSONE) 作为从 DNS 服务器（对外提供服务">
<meta property="og:type" content="article">
<meta property="og:title" content="BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务">
<meta property="og:url" content="https://r2wind.cn/articles/20231127.html">
<meta property="og:site_name" content="归去如风">
<meta property="og:description" content="本文介绍如何使用 BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务，一般来讲，对于高可用的场景来说，单一的 DNS 服务商提供的 DNS 服务无法满足灾备的需求，所以我们需要使用多个 DNS 服务商来进行冗余备份，本文将指导您使用 BIND 9 作为主 DNS 服务器（不对外提供服务），CloudNS 和 NS1 (NSONE) 作为从 DNS 服务器（对外提供服务">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://resources.r2wind.cn/img/202311/sunset-8401670_1920.jpg">
<meta property="article:published_time" content="2023-11-27T09:10:54.000Z">
<meta property="article:modified_time" content="2023-11-27T09:10:54.000Z">
<meta property="article:author" content="小泽">
<meta property="article:tag" content="域名">
<meta property="article:tag" content="解析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://resources.r2wind.cn/img/202311/sunset-8401670_1920.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务",
  "url": "https://r2wind.cn/articles/20231127.html",
  "image": "https://resources.r2wind.cn/img/202311/sunset-8401670_1920.jpg",
  "datePublished": "2023-11-27T09:10:54.000Z",
  "dateModified": "2023-11-27T09:10:54.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "小泽",
      "url": "https://r2wind.cn"
    }
  ]
}</script><link rel="shortcut icon" href="https://resources.r2wind.cn/img/logo.ico"><link rel="canonical" href="https://r2wind.cn/articles/20231127.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><meta/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://mirrors.r2wind.cn/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MG9VW91X52"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-MG9VW91X52')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-MG9VW91X52', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://mirrors.r2wind.cn/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://fonts.r2wind.cn/fonts.css"><script src="https://tam.cdn-go.cn/aegis-sdk/latest/aegis.min.js"></script><script src="https://resources.r2wind.cn/js/rum.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="归去如风" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(https://resources.r2wind.cn/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://resources.r2wind.cn/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-thumbs-up"></i><span> 友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://yjz.hk"><span> 繁體中文</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://r2wind.com"><span> English</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">归去如风</span></a><a class="nav-page-title" href="/"><span class="site-name">BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-thumbs-up"></i><span> 友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://yjz.hk"><span> 繁體中文</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://r2wind.com"><span> English</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-27T09:10:54.000Z" title="发表于 2023-11-27 17:10:54">2023-11-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-27T09:10:54.000Z" title="更新于 2023-11-27 17:10:54">2023-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><blockquote>
<p>本文介绍如何使用 BIND 9+CloudNS+NS1 (NSONE) 搭建高可用 DNS 服务，一般来讲，对于高可用的场景来说，单一的 DNS 服务商提供的 DNS 服务无法满足灾备的需求，所以我们需要使用多个 DNS 服务商来进行冗余备份，本文将指导您使用 BIND 9 作为主 DNS 服务器（不对外提供服务），CloudNS 和 NS1 (NSONE) 作为从 DNS 服务器（对外提供服务）来搭建高可用 DNS 服务。</p>
</blockquote>
<div class="note warning simple"><p>本文部分内容将指导您如何使用自己的域名作为 DNS 服务器地址，以下简称Vanitydns，如果您不需要实现该效果，可以按说明跳过相关步骤。</p>
</div>

<h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><ul>
<li>服务器&#x2F;云服务器：BIND 9 对配置要求不高，如您的解析记录数量较少，一般 1 核 1G 的服务器即可满足需求；该服务器 53 端口需要对外开放，如果您使用的是云服务器，需要在云平台的安全组中添加 53 端口的入站规则（TCP&amp;UDP）。</li>
<li>系统环境：本示例中使用的是 Debian12</li>
<li>DNS 服务域名（Vanitydns 需要）：为了实现服务的高可用性，至少需要两个域名，这两个域名需要在不同注册局&amp;注册商（如.com和.org；腾讯云和阿里云），以避免某家注册商或注册局服务出现异常，且注册商需要支持添加 DNS host(Glue record)。笔者使用的是 AWS Route53 和 Dynadot 两家注册商，以及 vanitydns.com 和 vanitydns.org 两个注册局不同的域名。不考虑高可用性的情况下，只需要一个域名即可。</li>
<li>DNS 服务商服务（Vanitydns 需要）：CloudNS 需要付费服务，具体费用根据您的需求而定；NS1 (NSONE) 提供免费服务，但需要申请账号，若使用量超出 NS1 (NSONE) 免费额度，则需要付费，具体费用根据您的需求而定。</li>
</ul>
<div class="note warning simple"><p>NS1 (NSONE) 注册账号需要人工审核，审核通过后才能完成注册，审核时间一般为 1-2 个工作日。</p>
</div>

<p>传送门：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://s.ddnsip.cn/amyr9">CloudNS 账号注册</a></li>
<li><a target="_blank" rel="noopener" href="https://ns1.com/signup">NS1 (NSONE) 账号注册</a></li>
</ul>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="安装-BIND-9"><a href="#安装-BIND-9" class="headerlink" title="安装 BIND 9"></a>安装 BIND 9</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install BIND 9</span><br></pre></td></tr></table></figure>
<h3 id="BIND-9-基础配置"><a href="#BIND-9-基础配置" class="headerlink" title="BIND 9 基础配置"></a>BIND 9 基础配置</h3><p>配置文件路径：<code>/etc/bind/named.conf.options</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">	directory <span class="string">&quot;/var/cache/bind&quot;</span>;</span><br><span class="line"></span><br><span class="line">	// If there is a firewall between you and nameservers you want</span><br><span class="line">	// to talk to, you may need to fix the firewall to allow multiple</span><br><span class="line">	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113</span><br><span class="line"></span><br><span class="line">	// If your ISP provided one or more IP addresses <span class="keyword">for</span> stable </span><br><span class="line">	// nameservers, you probably want to use them as forwarders.  </span><br><span class="line">	// Uncomment the following block, and insert the addresses replacing </span><br><span class="line">	// the all-0<span class="string">&#x27;s placeholder.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// forwarders &#123;</span></span><br><span class="line"><span class="string">	// 	0.0.0.0;</span></span><br><span class="line"><span class="string">	// &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	//========================================================================</span></span><br><span class="line"><span class="string">	// If BIND logs error messages about the root key being expired,</span></span><br><span class="line"><span class="string">	// you will need to update your keys.  See https://www.isc.org/bind-keys</span></span><br><span class="line"><span class="string">	//========================================================================</span></span><br><span class="line"><span class="string">	dnssec-validation auto;</span></span><br><span class="line"><span class="string">	listen-on-v6 &#123; any; &#125;;</span></span><br><span class="line"><span class="string">    listen-on &#123; any; &#125;;</span></span><br><span class="line"><span class="string">	allow-query-cache &#123; none; &#125;;</span></span><br><span class="line"><span class="string">	allow-query &#123; any; &#125;;</span></span><br><span class="line"><span class="string">    recursion no; // 禁用递归查询</span></span><br><span class="line"><span class="string">	rate-limit &#123;</span></span><br><span class="line"><span class="string">        responses-per-second 500; // 速率限制：每秒最多响应500次，由于不对外提供服务，一般不需要配置</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>如您需要记录相关日志，可在下面添加日志配置，详细配置请参考 <a target="_blank" rel="noopener" href="https://kb.isc.org/docs/aa-01526">BIND 9 日志配置</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">logging &#123;</span><br><span class="line">     channel default_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/default&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel auth_servers_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/auth_servers&quot;</span> versions 100 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel dnssec_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/dnssec&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel zone_transfers_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/zone_transfers&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel ddns_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/ddns&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel client_security_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/client_security&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel rate_limiting_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/rate_limiting&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel rpz_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/rpz&quot;</span> versions 3 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel queries_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/queries&quot;</span> versions 600 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel query-errors_log &#123;</span><br><span class="line">          file <span class="string">&quot;/var/log/named/query-errors&quot;</span> versions 5 size 20m;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          severity dynamic;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel default_syslog &#123;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          syslog daemon;</span><br><span class="line">          severity info;</span><br><span class="line">     &#125;;</span><br><span class="line">     channel default_debug &#123;</span><br><span class="line">          print-time <span class="built_in">yes</span>;</span><br><span class="line">          print-category <span class="built_in">yes</span>;</span><br><span class="line">          print-severity <span class="built_in">yes</span>;</span><br><span class="line">          file <span class="string">&quot;named.run&quot;</span>;</span><br><span class="line">          severity dynamic;</span><br><span class="line">     &#125;;</span><br><span class="line">     category default &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category config &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category dispatch &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category network &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category general &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category zoneload &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category resolver &#123; auth_servers_log; default_debug; &#125;;</span><br><span class="line">     category cname &#123; auth_servers_log; default_debug; &#125;;</span><br><span class="line">     category delegation-only &#123; auth_servers_log; default_debug; &#125;;</span><br><span class="line">     category lame-servers &#123; auth_servers_log; default_debug; &#125;;</span><br><span class="line">     category edns-disabled &#123; auth_servers_log; default_debug; &#125;;</span><br><span class="line">     category dnssec &#123; dnssec_log; default_debug; &#125;;</span><br><span class="line">     category notify &#123; zone_transfers_log; default_debug; &#125;;</span><br><span class="line">     category xfer-in &#123; zone_transfers_log; default_debug; &#125;;</span><br><span class="line">     category xfer-out &#123; zone_transfers_log; default_debug; &#125;;</span><br><span class="line">     category client&#123; client_security_log; default_debug; &#125;;</span><br><span class="line">     category security &#123; client_security_log; default_debug; &#125;;</span><br><span class="line">     category rate-limit &#123; rate_limiting_log; default_debug; &#125;;</span><br><span class="line">     category spill &#123; rate_limiting_log; default_debug; &#125;;</span><br><span class="line">     category database &#123; rate_limiting_log; default_debug; &#125;;</span><br><span class="line">     category rpz &#123; rpz_log; default_debug; &#125;;</span><br><span class="line">     category trust-anchor-telemetry &#123; default_syslog; default_debug; default_log; &#125;;</span><br><span class="line">     category queries &#123; queries_log; &#125;;</span><br><span class="line">     category query-errors &#123;query-errors_log; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="创建域名区域文件"><a href="#创建域名区域文件" class="headerlink" title="创建域名区域文件"></a>创建域名区域文件</h3><blockquote>
<p>区域文件记录了域名的解析记录，每个域名都需要一个区域文件，区域文件默认可以存放在 <code>/var/cache/bind</code> 目录下，也可以自定义存放路径，本示例中使用的是默认路径，区域文件无特殊命名规则，可以使用域名作为文件名（不需要指定后缀），或使用 .txt&#x2F;.zones&#x2F;.zone&#x2F;.db 等作为后缀，本文未指定后缀。</p>
</blockquote>
<p>此处以 yjz.hk 为例，在 <code>/var/cache/bind</code> 下创建 yjz.hk 的区域文件，文件名为 yjz.hk</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1d    ; default TTL <span class="keyword">for</span> zone</span><br><span class="line"><span class="variable">$ORIGIN</span> yjz.hk.</span><br><span class="line">@         IN      SOA   ns1.example.com. hostmaster.example.com. (</span><br><span class="line">                                2023112701 ; serial number</span><br><span class="line">                                1h        ; refresh</span><br><span class="line">                                3m        ; update retry</span><br><span class="line">                                2w         ; expiry</span><br><span class="line">                                1m         ; minimum</span><br><span class="line">                                )</span><br><span class="line">@	86400	IN	NS	ns1.vanitydns.com.</span><br><span class="line">@	86400	IN	NS	ns2.vanitydns.com.</span><br><span class="line">@	86400	IN	NS	ns3.vanitydns.org.</span><br><span class="line">@	86400	IN	NS	ns4.vanitydns.org.</span><br><span class="line">@	300	IN	A	104.26.7.130</span><br><span class="line">@	300	IN	A	104.26.6.130</span><br><span class="line">@	300	IN	A	172.67.70.42</span><br><span class="line">@	300	IN	AAAA	2606:4700:20::681a:682</span><br><span class="line">@	300	IN	AAAA	2606:4700:20::ac43:462a</span><br><span class="line">@	300	IN	AAAA	2606:4700:20::681a:782</span><br></pre></td></tr></table></figure>
<div class="note info simple"><ul>
<li>$TTL：默认 TTL，如果某条记录没有指定 TTL，则使用默认 TTL</li>
<li>$ORIGIN：域名，如果某条记录没有指定域名，则使用 $ORIGIN</li>
<li>@：代表域名本身，如 yjz.hk</li>
<li>IN：代表 Internet</li>
<li>SOA：Start of Authority，域名的权威记录，每个域名只能有一个 SOA 记录，其中 ns1.example.com. 代表主名称服务器，hostmaster.example.com. 代表域名管理员邮箱地址，2023112701 代表序列号，1h 代表刷新时间，3m 代表重试时间，2w 代表过期时间，1m 代表最小 TTL。注意：在 zone 文件中，所有完整的域名后面都需要加上一个点，如 ns1.example.com.，否则会自动加上 $ORIGIN，变成 ns1.example.com.yjz.hk；此外序列号在每次修改 zone 文件后都需要递增，否则从 DNS 服务器无法同步获取到最新的解析记录。</li>
<li>NS：Name Server，域名服务器，每个域名至少需要两个 NS 记录，如果您未使用 Vanitydns，请配置CloudNS和NS1 (NSONE) 提供的 NS 服务器地址（建议总共不超过 4 个，每家各配置两个，后面会教大家如何获取两家提供的NS，这里随便写两个域名即可，如pns41.cloudns.net., pns42.cloudns.net., dns1.p01.nsone.net., dns2.p01.nsone.net.），如果您使用了 Vanitydns，请配置您用来提供 DNS 服务的 NS 服务器地址，如 ns1.vanitydns.com.，ns2.vanitydns.com.，ns3.vanitydns.org.，ns4.vanitydns.org.。</li>
<li>A：Address，IPv4 地址，如果您的域名需要解析 IPv4 地址，请添加 A 记录。</li>
<li>AAAA：IPv6 地址，如果您的域名需要解析 IPv6 地址，请添加 AAAA 记录。</li>
</ul>
</div>
<h3 id="创建-Slave-Secondary-区域"><a href="#创建-Slave-Secondary-区域" class="headerlink" title="创建 Slave&#x2F;Secondary 区域"></a>创建 Slave&#x2F;Secondary 区域</h3><blockquote>
<p>Slave&#x2F;Secondary 区域是指从 DNS 服务器，它从主 DNS 服务器获取域名的解析记录，然后提供给客户端，本示例中使用的是 CloudNS 和 NS1 (NSONE) 作为 Slave&#x2F;Secondary 区域，BIND 9 作为主 DNS 服务器，所以需要在 CloudNS 和 NS1 (NSONE) 上创建 Slave&#x2F;Secondary 区域。</p>
</blockquote>
<h4 id="CloudNS-创建-Slave-Secondary-区域"><a href="#CloudNS-创建-Slave-Secondary-区域" class="headerlink" title="CloudNS 创建 Slave&#x2F;Secondary 区域"></a>CloudNS 创建 Slave&#x2F;Secondary 区域</h4><ol>
<li>登录 <a target="_blank" rel="noopener" href="https://s.ddnsip.cn/amyr9">CloudNS 管理控制台</a>，点击<code>创建区域</code><br><img src="https://resources.r2wind.cn/img/202311/20231127152820.png" alt="创建区域"></li>
<li>选择<code>备用域</code><br><img src="https://resources.r2wind.cn/img/202311/20231127152954.png" alt="备用域"></li>
<li>填写域名和主 DNS 服务器地址，主 DNS 服务器地址填写 BIND 9 服务器的 IP 地址<br><img src="https://resources.r2wind.cn/img/202311/20231127153111.png" alt="填写域名和主 DNS 服务器地址"></li>
<li>点击<code>创建</code>，完成创建</li>
<li>创建完成后点击页面的<code>基础设置</code>记录下用于传输的 IP 地址，后面配置 BIND 9 区域文件时需要用到<br><img src="https://resources.r2wind.cn/img/202311/20231127155716.png" alt="基础设置"></li>
</ol>
<div class="note info simple"><p>CloudNS 的 NS 服务器地址可在控制面板<code>可用的名称服务器查看</code><br><img src="https://resources.r2wind.cn/img/202311/20231127153506.png" alt="可用的名称服务器"></p>
</div>

<h4 id="NS1-NSONE-创建-Slave-Secondary-区域"><a href="#NS1-NSONE-创建-Slave-Secondary-区域" class="headerlink" title="NS1 (NSONE) 创建 Slave&#x2F;Secondary 区域"></a>NS1 (NSONE) 创建 Slave&#x2F;Secondary 区域</h4><ol>
<li>登录 <a target="_blank" rel="noopener" href="https://my.nsone.net/#/dns/management/zones">NS1 (NSONE) 管理控制台</a>，点击<code>+</code><br><img src="https://resources.r2wind.cn/img/202311/20231127153626.png" alt="创建区域"></li>
<li>填写域名并选择<code>Secondary Zone</code>，主 DNS 服务器地址填写 BIND 9 服务器的 IP 地址<br><img src="https://resources.r2wind.cn/img/202311/20231127153851.png" alt="填写域名和主 DNS 服务器地址"></li>
<li>点击<code>Save Zone</code>，完成创建</li>
</ol>
<div class="note warning simple"><ul>
<li>请注意，NS1 域名内需要填写 FQDN，即需要填写完整的域名，如 yjz.hk.,而不是 yjz.hk</li>
<li>NS1 (NSONE) 用于AXFR&#x2F;IXFR传输的 IP 地址为<code>192.135.223.10</code></li>
</ul>
</div>
<div class="note info simple"><ul>
<li>NS1 (NSONE) 的辅助 DNS 服务器地址可在区域控制面板中的<code>Name Servers</code>查看<br><img src="https://resources.r2wind.cn/img/202311/20231127160231.png" alt="Name Servers"></li>
</ul>
</div>

<h3 id="修改域名区域文件中的-DNS-服务器地址"><a href="#修改域名区域文件中的-DNS-服务器地址" class="headerlink" title="修改域名区域文件中的 DNS 服务器地址"></a>修改域名区域文件中的 DNS 服务器地址</h3><p>至此我们已经获取到了两家厂商的 NS 服务器地址，需要根据实际获取到的地址修改区域文件中的 NS 记录和 SOA 记录，以 yjz.hk 为例，修改后的 SOA 和 NS 记录如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1d    ; default TTL <span class="keyword">for</span> zone</span><br><span class="line"><span class="variable">$ORIGIN</span> yjz.hk.</span><br><span class="line">@         IN      SOA   pns41.cloudns.net. hostmaster.yjz.hk. (</span><br><span class="line">                                2023112702 ; serial number</span><br><span class="line">                                1h        ; refresh</span><br><span class="line">                                3m        ; update retry</span><br><span class="line">                                2w         ; expiry</span><br><span class="line">                                1m         ; minimum</span><br><span class="line">                                )</span><br><span class="line">@	86400	IN	NS	pns41.cloudns.net.</span><br><span class="line">@	86400	IN	NS	pns42.cloudns.net.</span><br><span class="line">@	86400	IN	NS	dns1.p01.nsone.net.</span><br><span class="line">@	86400	IN	NS	dns2.p01.nsone.net.</span><br></pre></td></tr></table></figure>
<div class="note primary simple"><p>如果您使用的是 Vanitydns，请将上面的 NS 记录修改为您用来提供 DNS 服务的 NS 服务器地址，如 ns1.vanitydns.com.，ns2.vanitydns.com.，ns3.vanitydns.org.，ns4.vanitydns.org.，SOA 记录中的主名称服务器也需要修改为您用来提供 DNS 服务的 NS 服务器地址，如 ns1.vanitydns.com.。</p>
</div>

<h3 id="配置-BIND-9-加载区域文件"><a href="#配置-BIND-9-加载区域文件" class="headerlink" title="配置 BIND 9 加载区域文件"></a>配置 BIND 9 加载区域文件</h3><p>配置文件路径：<code>/etc/bind/named.conf.local</code>，在原有配置的基础上添加以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">&quot;yjz.hk&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;/var/cache/bind/yjz.hk&quot;</span>;</span><br><span class="line">    allow-transfer &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">    also-notify &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<div class="note info simple"><ul>
<li>zone：域名，需要与区域文件中的域名保持一致</li>
<li>type：区域类型，主 DNS 服务器填写 master</li>
<li>file：区域文件路径，需要与区域文件实际路径保持一致</li>
<li>allow-transfer：允许传输的 IP 地址，填写 CloudNS 和 NS1 (NSONE) 提供的用于传输的 IP 地址</li>
<li>also-notify：通知的 IP 地址，用于通知 CloudNS 和 NS1 (NSONE) 更新解析记录，填写 CloudNS 和 NS1 (NSONE) 提供的用于传输的 IP 地址</li>
</ul>
</div>
<h3 id="重载-BIND-9-配置"><a href="#重载-BIND-9-配置" class="headerlink" title="重载 BIND 9 配置"></a>重载 BIND 9 配置</h3><h4 id="检查配置文件是否正确"><a href="#检查配置文件是否正确" class="headerlink" title="检查配置文件是否正确"></a>检查配置文件是否正确</h4><p>重载配置前需要检查配置文件是否正确，使用以下命令检查配置文件是否正确：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> named-checkconf /etc/bind/named.conf</span><br></pre></td></tr></table></figure>
<p>如果配置文件正确，则不会有任何输出，如果配置文件有错误，则会输出错误信息，需要根据错误信息修改配置文件，修改完成后再次检查配置文件是否正确，直到没有错误信息为止。</p>
<h4 id="检查区域文件是否正确"><a href="#检查区域文件是否正确" class="headerlink" title="检查区域文件是否正确"></a>检查区域文件是否正确</h4><p>此外还需要检查区域文件是否正确，使用以下命令检查区域文件是否正确，请注意替换域名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> named-checkzone yjz.hk /var/cache/bind/yjz.hk</span><br></pre></td></tr></table></figure>
<p>如果区域文件正确，您将会看到如下输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zone yjz.hk/IN: loaded serial 2023112702</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>如有误，请根据错误信息修改区域文件，修改完成后再次检查区域文件是否正确，直到没有错误信息为止。</p>
<h4 id="重载配置"><a href="#重载配置" class="headerlink" title="重载配置"></a>重载配置</h4><p>配置文件检查完成后，使用以下命令重载配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl reload BIND 9</span><br></pre></td></tr></table></figure>
<h3 id="检查-Slave-Secondary-区域是否正常"><a href="#检查-Slave-Secondary-区域是否正常" class="headerlink" title="检查 Slave&#x2F;Secondary 区域是否正常"></a>检查 Slave&#x2F;Secondary 区域是否正常</h3><p>配置完成后，需要检查 Slave&#x2F;Secondary 区域是否正常同步</p>
<h4 id="CloudNS-检查-Slave-Secondary-区域是否正常同步"><a href="#CloudNS-检查-Slave-Secondary-区域是否正常同步" class="headerlink" title="CloudNS 检查 Slave&#x2F;Secondary 区域是否正常同步"></a>CloudNS 检查 Slave&#x2F;Secondary 区域是否正常同步</h4><p>请点击区域控制面板中的<code>检查 SOA</code>，查看 SOA 记录是否和主 DNS 服务器保持一致，如下图所示：<br><img src="https://resources.r2wind.cn/img/202311/20231127162259.png" alt="检查 SOA"></p>
<h4 id="NS1-NSONE-检查-Slave-Secondary-区域是否正常同步"><a href="#NS1-NSONE-检查-Slave-Secondary-区域是否正常同步" class="headerlink" title="NS1 (NSONE) 检查 Slave&#x2F;Secondary 区域是否正常同步"></a>NS1 (NSONE) 检查 Slave&#x2F;Secondary 区域是否正常同步</h4><p>请点击区域控制面板中的<code>ZONE SETTINGS</code>，查看<code>SECONDARY ZONE STATUS</code>是否为<code>OK</code>，以及<code>SERIAL</code>是否和主 DNS 服务器保持一致，如下图所示：<br><img src="https://resources.r2wind.cn/img/202311/20231127162614.png" alt="SECONDARY ZONE STATUS"></p>
<h3 id="前往域名注册商修改域名-DNS-服务器地址"><a href="#前往域名注册商修改域名-DNS-服务器地址" class="headerlink" title="前往域名注册商修改域名 DNS 服务器地址"></a>前往域名注册商修改域名 DNS 服务器地址</h3><p>请前往域名注册商修改域名 DNS 服务器地址，地址需要与 NS 记录保持一致，具体操作方法请参考域名注册商提供的文档，这里不再赘述。使用 Vanitydns 请在完成后续配置后再修改域名 DNS 服务器地址，否则可能会遇到异常操作。</p>
<div class="note success simple"><p>至此，相关的配置已经完成，如您不需要开启 DNSSEC、不需要使用自己的域名作为 DNS 服务器地址，那到此结束；如果你需要相关的配置，那请看后续操作；</p>
</div>

<h2 id="后续操作（可选）"><a href="#后续操作（可选）" class="headerlink" title="后续操作（可选）"></a>后续操作（可选）</h2><h3 id="开启-DNSSEC"><a href="#开启-DNSSEC" class="headerlink" title="开启 DNSSEC"></a>开启 DNSSEC</h3><p>DNSSEC 是一种用于保护 DNS 服务器免受 DNS 欺骗的技术，DNSSEC 通过数字签名的方式来验证 DNS 服务器的响应是否被篡改，从而保证 DNS 服务器的响应是可信的，关于其原理，这里不再赘述。</p>
<h4 id="修改-BIND-9-配置文件"><a href="#修改-BIND-9-配置文件" class="headerlink" title="修改 BIND 9 配置文件"></a>修改 BIND 9 配置文件</h4><p>配置文件路径：&#x2F;etc&#x2F;bind&#x2F;named.conf.local，需要在原有配置文件中添加<code>dnssec-policy</code>和<code>inline-signing</code>配置，添加完如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">&quot;yjz.hk&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> primary;</span><br><span class="line">    file <span class="string">&quot;/var/cache/bind/yjz.hk&quot;</span>;</span><br><span class="line">    dnssec-policy default;</span><br><span class="line">    inline-signing <span class="built_in">yes</span>;</span><br><span class="line">    allow-transfer &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">    also-notify &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="重载-BIND-9-配置-1"><a href="#重载-BIND-9-配置-1" class="headerlink" title="重载 BIND 9 配置"></a>重载 BIND 9 配置</h4><p>配置文件修改完成后，使用以下命令重载配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl reload BIND 9</span><br></pre></td></tr></table></figure>
<p>当然，重载前记得按上面的方法检查配置文件是否正确哦~</p>
<h4 id="获取-DNSSEC-相关信息"><a href="#获取-DNSSEC-相关信息" class="headerlink" title="获取 DNSSEC 相关信息"></a>获取 DNSSEC 相关信息</h4><p>我们需要获取 DNSKEY 或者 DS 记录，以及 NSEC3 记录，这些记录用于在域名注册商处配置 DNSSEC，以 yjz.hk 为例，获取 DNSSKEY 和 DS 记录的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/cache/bind</span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
<p>通常您将会在输出中看到类似于<code>K+域名+数字+数字.key</code>的以 key 结尾文件，例如<code>Kyjz.hk.+013+383xx.key</code>，DNSKEY 记录和 DS 记录都在该文件中:</p>
<div class="note info simple"><p>大多域名注册商目前都需要 DS 记录，但是也有少数域名注册商需要 DNSKEY 记录，建议根据实际情况选择配置 DNSKEY 记录或 DS 记录，如果您不知道域名注册商需要哪种记录，请联系域名注册商客服。</p>
</div>
<p>获取 DS 记录的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnsssec-dsfromkey -2 Kyjz.hk.+013+383xx.key</span><br></pre></td></tr></table></figure>
<p>通常您将会看到类似于以下输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yjz.hk. IN DS 38356 13 2 25FAD7782FB5654CE99D71F8D82EC690FC1640976D306062BD118E5005xxxxxxx</span><br></pre></td></tr></table></figure>
<p>将其在域名注册商配置即可，如您不会配置，可以联系域名注册商客服，将其提供给客服协助配置。</p>
<p>获取 DNSKEY 记录的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> Kyjz.hk.+013+383xx.key</span><br></pre></td></tr></table></figure>
<p>通常您将会看到类似于以下输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">; This is a key-signing key, keyid xxxxx, <span class="keyword">for</span> yjz.hk.</span><br><span class="line">; Created: xxxxxxxxxxxxxxxxxxx</span><br><span class="line">; Publish: xxxxxxxxxxxxxxxxxxx</span><br><span class="line">; Activate: xxxxxxxxxxxxxxxxxx</span><br><span class="line">; SyncPublish: xxxxxxxxxxxxxxx</span><br><span class="line">yjz.hk. 3600 IN DNSKEY 257 3 13 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>
<p>最后一行则为 DNSKEY 记录，将其在域名注册商配置即可，如您不会配置，可以联系域名注册商客服，将其提供给客服协助配置。</p>
<div class="note primary simple"><p>CloudNS 和 NS1 (NSONE) 都会自动从主 DNS 服务器同步 DNSSEC 相关信息，所以您无需再去手动配置。</p>
</div>

<h4 id="检查-DNSSEC-是否正常"><a href="#检查-DNSSEC-是否正常" class="headerlink" title="检查 DNSSEC 是否正常"></a>检查 DNSSEC 是否正常</h4><p>在注册商完成配置后，需要检查 DNSSEC 是否正常，您可访问：<a target="_blank" rel="noopener" href="https://dnsviz.net/%EF%BC%8C%E8%BE%93%E5%85%A5%E6%82%A8%E7%9A%84%E5%9F%9F%E5%90%8D%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%9F%A5%E3%80%82">https://dnsviz.net/，输入您的域名进行检查。</a></p>
<h3 id="使用自己的域名作为-DNS-服务器地址（Vanitydns）"><a href="#使用自己的域名作为-DNS-服务器地址（Vanitydns）" class="headerlink" title="使用自己的域名作为 DNS 服务器地址（Vanitydns）"></a>使用自己的域名作为 DNS 服务器地址（Vanitydns）</h3><h4 id="创建-Glue-record"><a href="#创建-Glue-record" class="headerlink" title="创建 Glue record"></a>创建 Glue record</h4><blockquote>
<p>如您需要使用自己的域名作为 dns 服务器，则需要在域名注册商处创建 Glue record，Glue record 是指将域名和 IP 地址绑定的记录，用于解决域名解析时的循环依赖问题，例如：域名 yjz.hk 的 NS 服务器地址为 ns1.vanitydns.com.，ns2.vanitydns.com.，ns3.vanitydns.org.，ns4.vanitydns.org.，那么在解析 yjz.hk 时，需要先解析 ns1.vanitydns.com.，ns2.vanitydns.com.，ns3.vanitydns.org.，ns4.vanitydns.org.，然后再解析 yjz.hk，这样就会出现循环依赖问题，所以我们需要在域名注册商处创建 Glue record，将 ns1.vanitydns.com.，ns2.vanitydns.com.，ns3.vanitydns.org.，ns4.vanitydns.org. 和 IP 地址绑定，这样在解析 yjz.hk 时，就可以直接解析到 ns1.vanitydns.com.，ns2.vanitydns.com.，ns3.vanitydns.org.，ns4.vanitydns.org. 的 IP 地址，从而解决循环依赖问题。</p>
</blockquote>
<h5 id="获取-Glue-record-相关信息"><a href="#获取-Glue-record-相关信息" class="headerlink" title="获取 Glue record 相关信息"></a>获取 Glue record 相关信息</h5><p>前往注册商创建 Glue record 之前，我们需要获取 dns 服务器对应的 IP 地址：</p>
<h6 id="CloudNS-获取-dns-服务器对应的-IP-地址"><a href="#CloudNS-获取-dns-服务器对应的-IP-地址" class="headerlink" title="CloudNS 获取 dns 服务器对应的 IP 地址"></a>CloudNS 获取 dns 服务器对应的 IP 地址</h6><p>前往 CloudNS 区域控制面板，点击<code>基础设置</code>，记录下<code>可用的名称服务器</code>中的 IP 地址，如下图所示：<br><img src="https://resources.r2wind.cn/img/202311/20231127165513.png" alt="可用的名称服务器"></p>
<h6 id="NS1-NSONE-获取-dns-服务器对应的-IP-地址"><a href="#NS1-NSONE-获取-dns-服务器对应的-IP-地址" class="headerlink" title="NS1 (NSONE) 获取 dns 服务器对应的 IP 地址"></a>NS1 (NSONE) 获取 dns 服务器对应的 IP 地址</h6><p>NS1 没有直接提供 IP 地址，需要使用 nslookup 命令获取，以 dns1.p01.nsone.net. 为例，获取 IP 地址的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup dns1.p01.nsone.net.</span><br></pre></td></tr></table></figure>
<p>通常您将会看到类似于以下输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rttw@zach:~$ nslookup dns1.p01.nsone.net.</span><br><span class="line">Server:         192.168.0.1</span><br><span class="line">Address:        192.168.0.1#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:   dns1.p01.nsone.net</span><br><span class="line">Address: 198.51.44.1</span><br><span class="line">Name:   dns1.p01.nsone.net</span><br><span class="line">Address: 2620:4d:4000:6259:7:1:0:1</span><br></pre></td></tr></table></figure>
<p>其中 Address 为 IP 地址，将其记录下来，以备后用</p>
<h5 id="前往注册商创建-Glue-record"><a href="#前往注册商创建-Glue-record" class="headerlink" title="前往注册商创建 Glue record"></a>前往注册商创建 Glue record</h5><p>以 dynadot 为例，前往域名管理控制台，点击<code>服务器</code>，点击<code>注册域名服务器</code>，填写域名和 IP 地址，如下图所示：<br><img src="https://resources.r2wind.cn/img/202311/20231127165903.png" alt="注册域名服务器"><br><img src="https://resources.r2wind.cn/img/202311/20231127170230.png" alt="注册域名服务器"></p>
<div class="note info simple"><ul>
<li>主机名称：填写您用来提供 DNS 服务的域名，如 <code>ns4.vanitydns.org</code></li>
<li>IP 地址：填写您用来提供 DNS 服务的域名对应的 IP 地址，如<code>185.136.96.79</code>，注意 dynadot 创建时只能填写一个 IP 地址，可在后续修改继续添加</li>
</ul>
</div>

<div class="note warning simple"><ul>
<li>两家 DNS 服务商总共有 16 个 IP 地址（不含CloudNS免费IP），如何将这 16 个 IP 地址分散到四个 NS 服务器域名由你自己来决定，笔者的做法是 CloudNS 提供的 8 个 IP 地址，分配给了<code>ns1.vanitydns.com</code>和<code>ns2.vanitydns.com</code>，NS1 (NSONE) 提供的 8 个 IP 地址，分配给了<code>ns3.vanitydns.org</code>和<code>ns4.vanitydns.org</code>。</li>
<li>四个 NS 服务器域名都需要注册 Glue record，否则会出现循环依赖问题。</li>
<li>在某些注册商，Glue Record 被称为 DNS Host，如 腾讯云。</li>
</ul>
</div>
<h4 id="创建区域文件"><a href="#创建区域文件" class="headerlink" title="创建区域文件"></a>创建区域文件</h4><p>创建区域文件的方法与前面创建 yjz.hk 区域文件的方法相同，此处不再赘述，以 vanitydns.org 为例，创建的区域文件如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ORIGIN</span> vanitydns.org.</span><br><span class="line">@	180	IN	SOA	ns3.vanitydns.org. admin.vanitydns.com. 2023112702 3600 180 1209600 180</span><br><span class="line">ns3	86400	IN	A	198.51.44.1</span><br><span class="line">ns3	86400	IN	A   198.51.45.1</span><br><span class="line">ns3 86400   IN  A   47.107.117.38</span><br><span class="line">ns4	86400	IN	A	198.51.44.65</span><br><span class="line">ns4	86400	IN	A   198.51.45.65</span><br><span class="line">ns4 86400   IN  A   129.211.27.223</span><br><span class="line">ns3	86400	IN	AAAA	2620:4d:4000:6259:7:1:0:1</span><br><span class="line">ns3	86400	IN	AAAA	2a00:edc0:6259:7:1:0:0:2</span><br><span class="line">ns4 86400	IN	AAAA	2620:4d:4000:6259:7:1:0:3</span><br><span class="line">ns4 86400	IN	AAAA	2a00:edc0:6259:7:1:0:0:4</span><br><span class="line">@	86400	IN	NS	ns3.vanitydns.org.</span><br><span class="line">@	86400	IN	NS	ns4.vanitydns.org.</span><br></pre></td></tr></table></figure>
<div class="note info simple"><ul>
<li>A&#x2F;AAAA记录指向的 IP 需要与 Glue record 中填写的 IP 地址保持一致</li>
<li>NS 记录指向所对应的域名，需要与 Glue record 中填写的域名保持一致</li>
<li>在创建完<code>vanitydns.org</code>区域文件后，也别忘以相同的办法了配置<code>vanitydns.com</code>区域文件，否则会出现循环依赖问题</li>
</ul>
</div>
<h4 id="修改-BIND-9-配置文件-1"><a href="#修改-BIND-9-配置文件-1" class="headerlink" title="修改 BIND 9 配置文件"></a>修改 BIND 9 配置文件</h4><p>配置文件路径：<code>/etc/bind/named.conf.local</code>，需要在原有配置文件中添加这两个新的区域文件，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">&quot;vanitydns.com&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> primary;</span><br><span class="line">    file <span class="string">&quot;/var/named/vanitydns.com&quot;</span>;</span><br><span class="line">    dnssec-policy default;</span><br><span class="line">    inline-signing <span class="built_in">yes</span>;</span><br><span class="line">    allow-transfer &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        213.239.242.238; 213.133.105.6; 193.47.99.3; 2a01:4f8:0:a101::a:1; 2a01:4f8:d0a:2004::2; 2001:67c:192c::add:a3; //hetzner</span><br><span class="line">        47.107.117.38; 129.211.27.223; //CN</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">    also-notify &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        213.239.242.238; 213.133.105.6; 193.47.99.3; 2a01:4f8:0:a101::a:1; 2a01:4f8:d0a:2004::2; 2001:67c:192c::add:a3; //hetzner</span><br><span class="line">        47.107.117.38; 129.211.27.223; //CN</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">zone <span class="string">&quot;vanitydns.org&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> primary;</span><br><span class="line">    file <span class="string">&quot;/var/named/vanitydns.org&quot;</span>;</span><br><span class="line">    dnssec-policy default;</span><br><span class="line">    inline-signing <span class="built_in">yes</span>;</span><br><span class="line">    allow-transfer &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">    also-notify &#123;</span><br><span class="line">        109.201.133.196; 108.62.121.219; 185.10.17.44; 185.206.180.140; 185.136.96.79; </span><br><span class="line">        185.136.97.79; 185.136.98.79; 185.136.99.79; 185.206.180.205; 2a00:1768:1001:9::196; </span><br><span class="line">        2604:9a00:2100:b000:1::1; 2a07:8dc0:19::5d:37ff:fea5:bacd; 2a0b:1640:1:1:1:1:762:9aa6; </span><br><span class="line">        2a06:fb00:1::1:79; 2a06:fb00:1::2:79; 2a06:fb00:1::3:79; 2a06:fb00:1::4:79; 2a0b:1640:1:3::13; // cloudns</span><br><span class="line">        192.135.223.10; //NS1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="创建-Slave-Secondary-区域-1"><a href="#创建-Slave-Secondary-区域-1" class="headerlink" title="创建 Slave&#x2F;Secondary 区域"></a>创建 Slave&#x2F;Secondary 区域</h4><p>参照前面的步骤，前往 CloudNS 和 NS1 创建 Slave&#x2F;Secondary 区域，此处不再赘述。</p>
<h4 id="重载-BIND-9-配置-2"><a href="#重载-BIND-9-配置-2" class="headerlink" title="重载 BIND 9 配置"></a>重载 BIND 9 配置</h4><p>配置文件修改完成后，使用以下命令重载配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl reload BIND 9</span><br></pre></td></tr></table></figure>
<p>当然，重载前记得按上面的方法检查配置文件是否正确哦~</p>
<h4 id="检查-Slave-Secondary-区域是否正常-1"><a href="#检查-Slave-Secondary-区域是否正常-1" class="headerlink" title="检查 Slave&#x2F;Secondary 区域是否正常"></a>检查 Slave&#x2F;Secondary 区域是否正常</h4><p>参照前面的步骤，检查 Slave&#x2F;Secondary 区域是否正常同步，此处不再赘述。</p>
<h4 id="前往域名注册商修改域名-DNS-服务器地址-1"><a href="#前往域名注册商修改域名-DNS-服务器地址-1" class="headerlink" title="前往域名注册商修改域名 DNS 服务器地址"></a>前往域名注册商修改域名 DNS 服务器地址</h4><p>请前往域名注册商修改域名 DNS 服务器地址，地址需要与 NS 记录保持一致，具体操作方法请参考域名注册商提供的文档，这里不再赘述。</p>
<div class="note danger modern"><ul>
<li>注意：请分别修改<code>vanitydns.com</code>和<code>vanitydns.org</code>的 DNS 服务器地址后，再去修改<code>yjz.hk</code>的 DNS 服务器地址，否则可能会遇到异常操作。</li>
</ul>
</div>

<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol>
<li>看完之后感觉有点懵？<br>确实，这文章写的有点不适合小白，遇到任何问题发邮件或者前往<a target="_blank" rel="noopener" href="https://github.com/KincaidYang/r2w-cn"> GitHub 仓库</a>提 issue 都可以。</li>
<li>更改 DNS 服务器失败？<br>看起来大概是下面这样，如果你是腾讯云注册的域名，可在腾讯云域名控制台找到“技术交流群”点击扫码加群寻求帮助，其他域名服务商可以给笔者发邮件或者前往 <a target="_blank" rel="noopener" href="https://github.com/KincaidYang/r2w-cn">Github 仓库</a>提 issue。<br><img src="https://resources.r2wind.cn/img/202302/20230208203817.png" alt="修改失败"></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://r2wind.cn">小泽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://r2wind.cn/articles/20231127.html">https://r2wind.cn/articles/20231127.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://r2wind.cn" target="_blank">归去如风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%9F%9F%E5%90%8D/">域名</a><a class="post-meta__tags" href="/tags/%E8%A7%A3%E6%9E%90/">解析</a></div><div class="post-share"><div class="social-share" data-image="https://resources.r2wind.cn/img/202311/sunset-8401670_1920.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://mirrors.r2wind.cn/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://mirrors.r2wind.cn/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/articles/20240109.html" title="什么是 CNAME 展平？"><img class="cover" src="https://resources.r2wind.cn/img/202401/fields-8489339_1920.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">什么是 CNAME 展平？</div></div><div class="info-2"><div class="info-item-1"> 有些小伙伴们会经常遇到一个问题，在当前主机记录已经存在 CNAME 类型的记录后再在当前主机记录下添加其他记录类型时会提示某某类型记录和 CNAME 记录可能存在冲突，甚至有些解析服务商会直接不允许添加，比较常见的就是将主域名解析至 CDN 服务商提供的 CNAME 记录，然后再添加 MX（邮箱服务记录）时会碰到这个问题，这是为什么，该如何解决呢？接下来就让我们一起来了解一下吧。  为什么会出现这个问题？在 DNS 标准文件 RFC 1034 中，对 CNAME 记录的定义如下：  Identifies the canonical name of an alias.  译文：标识别名的规范名称。  翻译起来很拗口，但简单的来说 CNAME 记录就是把一个域名托管给另一个域名，该域名的所有解析记录都会被托管给另外一个域名，包括 MX、TXT、AAAA、A 等。我们以ddnsip.cn这个域名为例，它的解析记录如下：  在图中我们可以看到，ddnsip.cn这个域名通过 CNAME 记录指向了ddnsip.cn.eo.dnse3.com.，这也就意味着ddnsip.cn这个域名的所...</div></div></div></a><a class="pagination-related" href="/articles/20230914.html" title="使用 acme.sh 为在腾讯云（DNSPod）解析的域名自动申请证书（API3.0 / 腾讯云（DNSPod）API 密钥版本）"><img class="cover" src="https://resources.r2wind.cn/img/202309/storm-8244663_1920.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">使用 acme.sh 为在腾讯云（DNSPod）解析的域名自动申请证书（API3.0 / 腾讯云（DNSPod）API 密钥版本）</div></div><div class="info-2"><div class="info-item-1"> ACME（自动证书管理环境）是一个互联网工程任务组维护的协议，它允许自动化 Web 服务器证书的部署，acme.sh 是支持 ACME 协议流行的客户端之一，可以通过其实现 SSL 证书的自动申请、续期等等。一直以来，使用 acme.sh 为域名申请证书都是通过 DNSPod API 来实现的，但由于 DNSPod API 后续将不再维护，同时旧版DNSPod API 将不再有服务承诺，以及旧版 API 存在着接口不稳定、权限无法细分控制、国内站和国际站接口不统一等问题，因此笔者基于 dns_dp 脚本，适配了腾讯云 API3.0 版本（dns_tencent）。升级后的脚本将同时支持 DNSPod 国内站和国际站（暂仅支持国内站，国际站部分接口官方团队正在排期适配，预计 2024Q2 完成），不再需要针对国内站和国际站单独适配，同时支持使用子账号 API 密钥申请证书，权限可细分控制，接口更加稳定，使用更加方便、安全。  2023-09-25 更新：腾讯云 API3.0 脚本已合并到 acme.sh master 分支，可直接升级 acme.sh 后使用或通过一键安装脚本，无...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/articles/20211030.html" title="在DNSPod解析的域名如何设置DDNS(动态域名解析)"><img class="cover" src="https://resources.r2wind.cn/img/sea-164989_1280.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-30</div><div class="info-item-2">在DNSPod解析的域名如何设置DDNS(动态域名解析)</div></div><div class="info-2"><div class="info-item-1"> 本教程仅适用于解析托管在DNSPod平台上的域名，其他平台托管的域名请自行通过搜索引擎查找教程。   本教程前两个步骤通用，通过第三方插件或NAS&amp;路由器自带插件设置可参考前两步获取Token&amp;添加记录。   2022年2月15日：补充群晖设置教程  获取DNSPod Token1、打开并登录控制台-API密钥  注意这里一定要选择”DNSPod Token”而非”腾讯云API密钥”。  2、点击创建密钥，这里可能会进行安全验证，按照提示验证即可。3、设置密钥名称，这里根据需要随便填就好。4、记录密钥ID及Token  注意：Token仅在创建时展示一次，忘记的话请重新创建如果用于DDNS请不要设置IP白名单  添加解析记录1、打开并登录解析控制台2、找到对应的域名点击管理，这里以oed.im为例3、设置解析记录点击添加记录填写对应信息后点击保存完成添加。  主机记录：若直接解析主域名，请填@，若解析子域名，请填对应的值例如www。记录值：随便填一个IPv4，例如127.0.0.1(若使用IPv6,请随便填一个IPv6地址，例如fe80::0)记录类型：默认为A...</div></div></div></a><a class="pagination-related" href="/articles/20230108.html" title="使用 DNSPod 拉平 CNAME 记录（CDN 场景）"><img class="cover" src="https://resources.r2wind.cn/img/202301/clouds-7689828_1920.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-08</div><div class="info-item-2">使用 DNSPod 拉平 CNAME 记录（CDN 场景）</div></div><div class="info-2"><div class="info-item-1"> 由于 CNAME 跟任何记录都冲突的特性，在根域（@）下添加 CNAME 记录指向 CDN（或其他服务）会导致 mx（邮箱记录）、TXT（一些站长验证）、DS 等常用记录冲突等且多级 CNAME 会导致解析性能下降等问题，所以拉平是一个很不错的解决方案。但目前 DNSPod 并没有提供拉平的功能，所以需要自己写脚本调用 API 实现。（本文以腾讯云 CDN 为例，但是其他 CDN 服务商也可以使用，替换脚本里面的 CNAME 域名即可。）PS：自2019年1月接触互联网行业以来一直在做运营相关的工作，本身也不是学计算机相关专业的，代码写的可能不是很好，欢迎大佬们指正。  操作场景本文将指导您如何使用 DNSPod 的 API 实现拉平 CNAME 记录，以解决相关记录冲突的问题。（以腾讯云 CDN 为例） 前提条件 域名解析托管在腾讯云 DNSPod。 域名已绑定企业版或更高版本套餐。  方法说明流程图实现的方法大体如上图所示，获取 CDN 在31个省份三大运营商的调度结果，然后将调度结果更新到 DNSPod 上。 相关说明 因本人海外访问全部由 Cloudflare 提供服务...</div></div></div></a><a class="pagination-related" href="/articles/20210809.html" title="DNS解析出现问题怎么办？"><img class="cover" src="https://resources.r2wind.cn/img/mountain-6320288_1280.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="info-item-2">DNS解析出现问题怎么办？</div></div><div class="info-2"><div class="info-item-1"> 我们在使用DNS解析的过程中难免会遇到各种问题，在这里以腾讯云DNSPOD为例，写一下在遇到解析问题时如何排查，文章较长，可点击右下方目录直接跳转到你想看的地方。  确定是否为解析问题 一些新手会认为网站不能访问就是解析的锅，但其实并不一定是，所以我们首先要确定一下是否为解析问题。我们可以使用nslookup或dig等工具去判断解析是否正常，由于Windows系统基本只带了nslookup工具，所以接下来我们以nslookup为例。注：1、判断的前提条件是你已经在解析控制台添加了相应的记录，重要的事情说三遍：请确保您已经在控制台添加相应的记录！请确保您已经在控制台添加相应的记录！请确保您已经在控制台添加相应的记录！2、nslookup查询的域名可以是主域名（example.com）也可以是子域名（www.example.com），在查询时请以实际设置的主机记录为准。  判断A记录、AAAA记录、CNAME记录是否正常1nslookup 域名 例： 1nslookup r2wind.com 如图所示，可以正常查询到A记录或AAAA记录，解析正常，若异常，请参照解析问题排除。  若...</div></div></div></a><a class="pagination-related" href="/articles/20230109.html" title="使用华为云 DNS 拉平 CNAME 记录（CDN 场景）"><img class="cover" src="https://resources.r2wind.cn/img/202301/ship-7679100_1920.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-09</div><div class="info-item-2">使用华为云 DNS 拉平 CNAME 记录（CDN 场景）</div></div><div class="info-2"><div class="info-item-1"> 接上一篇文章使用 DNSPod 拉平 CNAME 记录（CDN 场景）这篇文章将介绍如何使用华为云 DNS 拉平 CNAME 记录（CDN 场景）。  操作场景本文将指导您如何使用华为云 DNS 的 API 实现拉平 CNAME 记录，以解决相关记录冲突的问题。 方法说明不再重复说明了，如有兴趣请看使用 DNSPod 拉平 CNAME 记录（CDN 场景） 前提条件 域名解析托管在华为云 DNS  项目地址https://github.com/KincaidYang/CNAMEFlattening 操作步骤获取脚本Flame 版本该版本适用于腾讯云 CDN、华为云 CDNIPv4 脚本： 1wget https://dl.r2wind.cn/script/CNAMEFlattening/HuaweiCloud/Flame/Huaweicloud-Flame-IPv4.py IPv6 脚本： 1wget https://dl.r2wind.cn/script/CNAMEFlattening/HuaweiCloud/Flame/Huaweicloud-Flame-IPv6.py F...</div></div></div></a><a class="pagination-related" href="/articles/20220522.html" title="DNS+IGTM实现访问流量智能调度"><img class="cover" src="https://resources.r2wind.cn/img/202205/seascape-4636549_1920.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-22</div><div class="info-item-2">DNS+IGTM实现访问流量智能调度</div></div><div class="info-2"><div class="info-item-1">操作场景智能全局流量管理（Intelligence Global Traffic Manager），简称IGTM，它可以帮助用户实现应用（例如：网页应用、直播、点播）的网络健康检查，并根据检测结果实现故障隔离和流量调度切换。也可根据用户地理位置或延迟实现流量的智能调度，从而实现各区域用户的就近接入。本文以通过DNS（IGTM）实现边缘节点智能调度为例进行演示。 适用场景需根据用户地理位置将流量调度到适合的边缘节点，并实现故障节点的自动剔除&amp;将流量分摊至不同的负载均衡节点，提升用户的访问体验的客户。 例如：CDN、直播、点播、手机（应用分发&#x2F;更新、系统升级等）、游戏（资源更新&#x2F;分发）、大型网站等。 场景需求描述： 说明：下述描述、图片仅为本案例中涉及到的相关场景、需求、节点分布，仅供参考，实际使用中请根据需要自行调整，或咨询您的客户经理获取专属方案。  场景描述 客户为提升全球用户访问体验，通过在全球各地域部署多台边缘节点的方式来提升用户访问速度和稳定性。  需求描述 根据客户地理位置或延迟返回不同地域的节点IP，并自动剔除故障边缘节点； 当自建CDN节...</div></div></div></a><a class="pagination-related" href="/articles/20230208.html" title="如何打造个性化的 DNS 服务器地址（用自己的域名作为 DNS 服务器地址）"><img class="cover" src="https://resources.r2wind.cn/img/202302/landscape-7744216_1920.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-08</div><div class="info-item-2">如何打造个性化的 DNS 服务器地址（用自己的域名作为 DNS 服务器地址）</div></div><div class="info-2"><div class="info-item-1"> 分类写成教程了，其实就是闲谈，平时我们如果注意观察的话就会发现挺多大厂域名的 DNS 都比较有个性，比如 qq.com 这个域名的 DNS 服务器为NS1.QQ.COM——NS4.QQ.COM，而我们自己的 DNS 服务器基本上就是千篇一律的f1g1ns1.dnspod.net&#x2F;xxx.dnspod.net&#x2F;dns(1-32).hichina.com&#x2F;ns(1-8).alidns.com等等，那如何用自己的域名做域名 DNS 服务器地址让我们的域名服务器看起来更个性化一些呢？答案就是贴牌（当然有能力你也可以自建）。所谓贴牌 DNS 就是使用解析厂商提供的解析服务，但是 DNS 服务器的域名，替换成你自己的，这个东西叫法比较多，包括像：贴牌 DNS&#x2F;Vanity Nameservers&#x2F;DNS Branding&#x2F;Custom Nameservers&#x2F;white-label name servers 等等，我比较喜欢 Vanity Nameservers 这个名称，直译过来就是“虚荣的域名服务器”，满足自己的虚荣...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://resources.r2wind.cn/img/avator.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">小泽</div><div class="author-info-description">一个自由自在的互联网民工</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/KincaidYang" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:yjz@r2wind.org" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.</span> <span class="toc-text">操作步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-BIND-9"><span class="toc-number">2.1.</span> <span class="toc-text">安装 BIND 9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BIND-9-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">BIND 9 基础配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9F%9F%E5%90%8D%E5%8C%BA%E5%9F%9F%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">创建域名区域文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Slave-Secondary-%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.4.</span> <span class="toc-text">创建 Slave&#x2F;Secondary 区域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CloudNS-%E5%88%9B%E5%BB%BA-Slave-Secondary-%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.4.1.</span> <span class="toc-text">CloudNS 创建 Slave&#x2F;Secondary 区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NS1-NSONE-%E5%88%9B%E5%BB%BA-Slave-Secondary-%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.4.2.</span> <span class="toc-text">NS1 (NSONE) 创建 Slave&#x2F;Secondary 区域</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9F%9F%E5%90%8D%E5%8C%BA%E5%9F%9F%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84-DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80"><span class="toc-number">2.5.</span> <span class="toc-text">修改域名区域文件中的 DNS 服务器地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-BIND-9-%E5%8A%A0%E8%BD%BD%E5%8C%BA%E5%9F%9F%E6%96%87%E4%BB%B6"><span class="toc-number">2.6.</span> <span class="toc-text">配置 BIND 9 加载区域文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD-BIND-9-%E9%85%8D%E7%BD%AE"><span class="toc-number">2.7.</span> <span class="toc-text">重载 BIND 9 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE"><span class="toc-number">2.7.1.</span> <span class="toc-text">检查配置文件是否正确</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%8C%BA%E5%9F%9F%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE"><span class="toc-number">2.7.2.</span> <span class="toc-text">检查区域文件是否正确</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">2.7.3.</span> <span class="toc-text">重载配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5-Slave-Secondary-%E5%8C%BA%E5%9F%9F%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">2.8.</span> <span class="toc-text">检查 Slave&#x2F;Secondary 区域是否正常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CloudNS-%E6%A3%80%E6%9F%A5-Slave-Secondary-%E5%8C%BA%E5%9F%9F%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8%E5%90%8C%E6%AD%A5"><span class="toc-number">2.8.1.</span> <span class="toc-text">CloudNS 检查 Slave&#x2F;Secondary 区域是否正常同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NS1-NSONE-%E6%A3%80%E6%9F%A5-Slave-Secondary-%E5%8C%BA%E5%9F%9F%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8%E5%90%8C%E6%AD%A5"><span class="toc-number">2.8.2.</span> <span class="toc-text">NS1 (NSONE) 检查 Slave&#x2F;Secondary 区域是否正常同步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%BE%80%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C%E5%95%86%E4%BF%AE%E6%94%B9%E5%9F%9F%E5%90%8D-DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80"><span class="toc-number">2.9.</span> <span class="toc-text">前往域名注册商修改域名 DNS 服务器地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E6%93%8D%E4%BD%9C%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">后续操作（可选）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-DNSSEC"><span class="toc-number">3.1.</span> <span class="toc-text">开启 DNSSEC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-BIND-9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.1.</span> <span class="toc-text">修改 BIND 9 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD-BIND-9-%E9%85%8D%E7%BD%AE-1"><span class="toc-number">3.1.2.</span> <span class="toc-text">重载 BIND 9 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-DNSSEC-%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">3.1.3.</span> <span class="toc-text">获取 DNSSEC 相关信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5-DNSSEC-%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">3.1.4.</span> <span class="toc-text">检查 DNSSEC 是否正常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9F%9F%E5%90%8D%E4%BD%9C%E4%B8%BA-DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80%EF%BC%88Vanitydns%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">使用自己的域名作为 DNS 服务器地址（Vanitydns）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Glue-record"><span class="toc-number">3.2.1.</span> <span class="toc-text">创建 Glue record</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Glue-record-%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">获取 Glue record 相关信息</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#CloudNS-%E8%8E%B7%E5%8F%96-dns-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E5%BA%94%E7%9A%84-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">3.2.1.1.1.</span> <span class="toc-text">CloudNS 获取 dns 服务器对应的 IP 地址</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#NS1-NSONE-%E8%8E%B7%E5%8F%96-dns-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E5%BA%94%E7%9A%84-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">3.2.1.1.2.</span> <span class="toc-text">NS1 (NSONE) 获取 dns 服务器对应的 IP 地址</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E5%BE%80%E6%B3%A8%E5%86%8C%E5%95%86%E5%88%9B%E5%BB%BA-Glue-record"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">前往注册商创建 Glue record</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9F%9F%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.2.</span> <span class="toc-text">创建区域文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-BIND-9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">3.2.3.</span> <span class="toc-text">修改 BIND 9 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Slave-Secondary-%E5%8C%BA%E5%9F%9F-1"><span class="toc-number">3.2.4.</span> <span class="toc-text">创建 Slave&#x2F;Secondary 区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD-BIND-9-%E9%85%8D%E7%BD%AE-2"><span class="toc-number">3.2.5.</span> <span class="toc-text">重载 BIND 9 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5-Slave-Secondary-%E5%8C%BA%E5%9F%9F%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8-1"><span class="toc-number">3.2.6.</span> <span class="toc-text">检查 Slave&#x2F;Secondary 区域是否正常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%BE%80%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C%E5%95%86%E4%BF%AE%E6%94%B9%E5%9F%9F%E5%90%8D-DNS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80-1"><span class="toc-number">3.2.7.</span> <span class="toc-text">前往域名注册商修改域名 DNS 服务器地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">常见问题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/articles/20250722.html" title="CodeBuddy - 全球首款产设研一体的 AI 全栈工程师体验如何？"><img src="https://resources.r2wind.cn/img/202507/website.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CodeBuddy - 全球首款产设研一体的 AI 全栈工程师体验如何？"/></a><div class="content"><a class="title" href="/articles/20250722.html" title="CodeBuddy - 全球首款产设研一体的 AI 全栈工程师体验如何？">CodeBuddy - 全球首款产设研一体的 AI 全栈工程师体验如何？</a><time datetime="2025-07-22T00:00:00.000Z" title="发表于 2025-07-22 08:00:00">2025-07-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/20250203.html" title="使用宝塔面板部署一个属于自己的 DeepSeek"><img src="https://resources.r2wind.cn/img/202502/robin-9376529_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用宝塔面板部署一个属于自己的 DeepSeek"/></a><div class="content"><a class="title" href="/articles/20250203.html" title="使用宝塔面板部署一个属于自己的 DeepSeek">使用宝塔面板部署一个属于自己的 DeepSeek</a><time datetime="2025-02-03T04:35:22.000Z" title="发表于 2025-02-03 12:35:22">2025-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/20241226.html" title="在 istoreos 上部署宝塔面板"><img src="https://resources.r2wind.cn/img/202412/winter-4680354_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在 istoreos 上部署宝塔面板"/></a><div class="content"><a class="title" href="/articles/20241226.html" title="在 istoreos 上部署宝塔面板">在 istoreos 上部署宝塔面板</a><time datetime="2024-12-26T02:58:56.000Z" title="发表于 2024-12-26 10:58:56">2024-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/20241221.html" title="在群晖 NAS 上部署宝塔面板"><img src="https://resources.r2wind.cn/img/202412/autumn-9249885_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在群晖 NAS 上部署宝塔面板"/></a><div class="content"><a class="title" href="/articles/20241221.html" title="在群晖 NAS 上部署宝塔面板">在群晖 NAS 上部署宝塔面板</a><time datetime="2024-12-21T06:21:32.000Z" title="发表于 2024-12-21 14:21:32">2024-12-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/20241209.html" title="在飞牛 NAS 上部署宝塔面板"><img src="https://resources.r2wind.cn/img/202412/watzmann-9024287_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在飞牛 NAS 上部署宝塔面板"/></a><div class="content"><a class="title" href="/articles/20241209.html" title="在飞牛 NAS 上部署宝塔面板">在飞牛 NAS 上部署宝塔面板</a><time datetime="2024-12-09T02:06:18.000Z" title="发表于 2024-12-09 10:06:18">2024-12-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://resources.r2wind.cn/background.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2017 - 2025 By 小泽</span><span class="framework-info"><span>Power By </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme By </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><span class="footer-separator">|</span><span>CoverImage By </span><a target="_blank" rel="noopener" href="https://pixabay.com/">Pixabay</a></span></div><div class="footer_custom_text"><a href="https://beian.mps.gov.cn/#/query/webSearch?code=21132402000032" rel="noreferrer" target="_blank"><img src="https://resources.r2wind.cn/img/gaba.png" alt="公安备案" style="width:20px; height:20px; vertical-align:sub;">辽公网安备21132402000032</a> <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><span>辽ICP备18005232号-1</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://mirrors.r2wind.cn/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax data-prefix="busuanzi_value" src="https://vortex.r2wind.cn/js"></script></div></body></html>